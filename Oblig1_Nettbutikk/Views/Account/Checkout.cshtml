@using Oblig1_Nettbutikk.Models
@{
    
    List<CartItem> cart = ViewBag.Cart;
    CustomerEditInfo customer = ViewBag.Customer;
}
<h1>Checkout</h1>
@Html.Partial("_CheckoutItemsPartial", cart)
@Html.Partial("_CheckoutAddressPartial", customer)
<hr />
<a id="btnConfirmPlaceOrder" class="btn btn-success">Bekreft kjøp</a>
@Html.ActionLink("Bekreft kjøp","PlaceOrder","Account",new { returnUrl = Request.RawUrl }, new { @class = "btn btn-success" })

<script>
    $(document).ready(function () {
        $("#btnConfirmPlaceOrder").unbind("click");
        $("#btnConfirmPlaceOrder").click(function () {

            $.ajax({
                url: '@Url.Action("PlaceOrder","Account")',
                method: "POST",
                success: function (result) {
                    var OrderId = parseInt(result);
                    alert(typeof OrderId+ " : "+ OrderId);
                    if (OrderId > 0) {
                        $(".cartCounter").text(0);
                        
                        // Return reciept
                        $.ajax({
                            url: '@Url.Action("GetReciept","Account")',
                            data: {
                                OrderId:OrderId
                            }, method: "POST",
                            success: function (result) {
                                var reciept = JSON.parse(result);
                                console.log("kvittor: " + reciept);
                            },error:function(result)
                            {
                                alert("error reciept: "+JSON.stringify(result));
                            }

                        })

                    } else
                        alert("success : men kunne ikke sette inn ordre.. :");


                }, error: function (result) {
                    alert("error:" + result);
                }
            })
        })
    })
</script>